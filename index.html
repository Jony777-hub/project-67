<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>IBprofen ‚Äî –£–º–Ω–∞—è –º–µ–¥—Å–∏—Å—Ç–µ–º–∞ (demo)</title>
<style>
  /* ----------------- RESET & BASE ----------------- */
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
  :root{
    --bg:#0f1115; --panel:#15181d; --muted:#9aa4ad; --accent:#60d1d9; --accent-2:#4aa0a7;
    --glass: rgba(255,255,255,0.03);
    --radius:14px;
    --soft: 12px;
  }
  .light {
    --bg:#f5f7f9; --panel:#ffffff; --muted:#5a6368; --accent:#0b9aa7; --accent-2:#07848b; --glass: rgba(0,0,0,0.04);
  }
  body{
    background: radial-gradient(1200px 600px at 10% 10%, rgba(18,22,26,0.6), transparent),
                radial-gradient(900px 400px at 90% 90%, rgba(6,10,14,0.5), transparent),
                var(--bg);
    color: #e6eef2;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:24px;
  }

  /* ---------- Layout ---------- */
  .app {
    max-width:1200px;
    margin:0 auto;
  }
  header.app-header{
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:space-between;
    padding:18px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    border-radius:var(--radius);
    box-shadow: 0 6px 20px rgba(0,0,0,0.45);
    margin-bottom:20px;
    backdrop-filter: blur(6px);
  }
  .brand{display:flex;gap:14px;align-items:center}
  .logo {
    width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));
    display:flex;align-items:center;justify-content:center;font-weight:700;color:#04282a;
    box-shadow: 0 6px 18px rgba(10,20,22,0.5);
  }
  .brand h1{font-size:18px;margin:0}
  .brand p{margin:0;font-size:12px;color:var(--muted)}

  .controls{display:flex;gap:12px;align-items:center}
  .control-btn{
    background:transparent;color:var(--accent);border:1px solid rgba(255,255,255,0.04);
    padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600;
  }
  .select, .btn {appearance:none}
  .theme-toggle{padding:8px 10px;border-radius:10px;border:none;background:var(--panel);cursor:pointer;color:var(--accent);}

  /* ---------- Main grid ---------- */
  .grid {
    display:grid;
    grid-template-columns: 1fr 420px;
    gap:20px;
  }

  /* ---------- Left: primary ---------- */
  .panel{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    padding:18px;border-radius:12px;backdrop-filter: blur(4px);
    border:1px solid rgba(255,255,255,0.02);
  }

  .section {margin-bottom:18px}
  h2.section-title{margin:0 0 12px 0;color:var(--accent);font-size:16px}

  /* ---------- Login area ---------- */
  #login-panel{max-width:520px;margin:24px auto}
  .field{display:flex;flex-direction:column;margin-bottom:10px}
  input[type="text"], input[type="password"], select, textarea{
    background:var(--panel);border:1px solid rgba(255,255,255,0.03);padding:10px 12px;border-radius:10px;color:inherit;
    outline:none;
  }
  input::placeholder, textarea::placeholder{color:var(--muted)}

  .login-actions{display:flex;gap:10px;align-items:center;margin-top:12px}
  .btn-primary{background:var(--accent);color:#04282a;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:10px 12px;border-radius:10px;color:var(--muted);cursor:pointer}

  .quick-logins{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .chip{background:var(--glass);padding:8px 10px;border-radius:999px;border:1px solid rgba(255,255,255,0.03);cursor:pointer;color:var(--muted)}

  /* ---------- Right: sidebar ---------- */
  .sidebar .panel {position:sticky;top:28px}

  /* ---------- App modules ---------- */
  .row{display:flex;gap:12px;align-items:center}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left;font-size:13px}
  th{color:var(--muted);font-weight:700}
  .small{font-size:12px;color:var(--muted)}

  /* ---------- AI box ---------- */
  .ai-box{display:flex;flex-direction:column;gap:8px}
  textarea{min-height:80px;resize:vertical}
  .ai-response{padding:12px;border-radius:10px;background:var(--glass);border:1px solid rgba(255,255,255,0.02);min-height:48px}

  /* ---------- Responsive ---------- */
  @media (max-width:980px){
    .grid{grid-template-columns:1fr}
    .sidebar{order:2}
  }
  /* ---------- Footer small ---------- */
  footer{margin-top:18px;text-align:center;color:var(--muted);font-size:12px}
</style>
</head>
<body>
<div class="app" id="app">
  <header class="app-header">
    <div class="brand">
      <div class="logo">IB</div>
      <div>
        <h1>IBprofen</h1>
        <p>Smart medical system ‚Ä¢ demo</p>
      </div>
    </div>

    <div class="controls">
      <div class="small">–Ø–∑—ã–∫</div>
      <select id="lang" class="select" aria-label="Language">
        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
        <option value="en">English</option>
        <option value="kz">“ö–∞–∑–∞“õ—à–∞</option>
        <option value="zh">‰∏≠Êñá</option>
      </select>

      <button class="theme-toggle" id="themeToggle" title="Toggle theme">üåì</button>
      <!-- quick help -->
      <button class="control-btn" id="helpBtn">–ü–æ–º–æ—â—å</button>
    </div>
  </header>

  <!-- LOGIN (shows until auth) -->
  <div id="login-panel" class="panel" role="region" aria-label="login">
    <h2 class="section-title">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
    <div class="field"><label>–õ–æ–≥–∏–Ω</label><input id="login" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω"></div>
    <div class="field"><label>–ü–∞—Ä–æ–ª—å</label><input id="password" type="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"></div>
    <div class="login-actions">
      <button class="btn-primary" id="doLogin">–í–æ–π—Ç–∏</button>
      <button class="btn-ghost" id="demoRegister">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–¥–µ–º–æ)</button>
    </div>

    <div class="small" style="margin-top:12px">–ë—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥ (–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏):</div>
    <div class="quick-logins" id="quick">
      <!-- quick buttons created by JS -->
    </div>
    <div id="login-error" class="small" style="color:#ff8b8b;margin-top:8px"></div>
    <div class="small" style="margin-top:12px;color:var(--muted)">
      –ü–æ–¥—Å–∫–∞–∑–∫–∞: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—Ö–æ–¥–∞. –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –∑–∞–ø–∏—Å—å—é, –±–æ–Ω—É—Å–∞–º–∏ –∏ –ò–ò.
    </div>
  </div>

  <!-- MAIN content (hidden until login) -->
  <div id="main" style="display:none">
    <div class="grid">
      <!-- LEFT (primary) -->
      <div>
        <div class="panel section" id="welcomePanel">
          <h2 class="section-title" id="welcomeTitle">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ IBprofen</h2>
          <p id="welcomeDesc">–ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–∞—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞: –∑–∞–ø–∏—Å—å –∫ –≤—Ä–∞—á—É, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞–º–∏ –∏ —É–º–Ω—ã–π –ò–ò‚Äë–ø–æ–º–æ—â–Ω–∏–∫.</p>
          <div style="margin-top:12px" class="row">
            <div class="card" style="min-width:180px">
              <div class="small">–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
              <div id="who" style="font-weight:700;margin-top:6px">‚Äî</div>
              <div id="role" class="small">‚Äî</div>
            </div>
            <div class="card" style="min-width:180px">
              <div class="small">–ë–∞–ª–∞–Ω—Å(–¥–µ–º–æ)</div>
              <div id="balance" style="font-weight:700;margin-top:6px">0</div>
              <div class="small">–ë–æ–Ω—É—Å—ã / —à—Ç—Ä–∞—Ñ—ã</div>
            </div>
          </div>
        </div>

        <!-- APPOINTMENTS -->
        <div class="panel section" id="appointmentsPanel">
          <h2 class="section-title" id="appointmentsTitle">–ó–∞–ø–∏—Å—å –∫ –≤—Ä–∞—á—É</h2>
          <div class="row">
            <div style="flex:1">
              <label id="selectPatientLabel">–ü–∞—Ü–∏–µ–Ω—Ç</label>
              <select id="selectPatient"></select>
            </div>
            <div style="flex:1">
              <label id="selectDoctorLabel">–í—Ä–∞—á</label>
              <select id="selectDoctor"></select>
            </div>
            <div style="flex:1">
              <label id="selectDateLabel">–î–∞—Ç–∞</label>
              <input id="selectDate" type="date">
            </div>
          </div>
          <div style="margin-top:12px">
            <button class="btn-primary" id="bookBtn">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
            <button class="btn-ghost" id="showSchedule">–ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–ø–∏—Å–∏</button>
          </div>

          <div style="margin-top:14px">
            <table id="appointmentsTable" aria-label="appointments table">
              <thead>
                <tr><th>–ü–∞—Ü–∏–µ–Ω—Ç</th><th>–í—Ä–∞—á</th><th>–î–∞—Ç–∞</th><th>–°—Ç–∞—Ç—É—Å</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- BONUSES -->
        <div class="panel section" id="bonusPanel">
          <h2 class="section-title" id="bonusTitle">–ë–æ–Ω—É—Å—ã –∏ —à—Ç—Ä–∞—Ñ—ã</h2>
          <div style="display:flex;gap:12px;flex-wrap:wrap" id="bonusControls"></div>
          <div style="margin-top:12px">
            <table id="bonusTable">
              <thead><tr><th>–ü–∞—Ü–∏–µ–Ω—Ç</th><th>–ë–æ–Ω—É—Å—ã</th><th>–®—Ç—Ä–∞—Ñ—ã</th><th>–ë–∞–ª–∞–Ω—Å</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- AI Assistant -->
        <div class="panel section" id="aiPanel">
          <h2 class="section-title" id="aiTitle">–ò–ò‚Äë–ø–æ–º–æ—â–Ω–∏–∫</h2>
          <div class="ai-box">
            <label id="aiInputLabel">–û–ø–∏—à–∏—Ç–µ —Å–∏–º–ø—Ç–æ–º—ã –∏–ª–∏ –≤–æ–ø—Ä–æ—Å</label>
            <textarea id="aiInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –±–æ–ª–∏—Ç –∂–∏–≤–æ—Ç –∏ —Ç–æ—à–Ω–æ—Ç–∞"></textarea>
            <div class="row">
              <button class="btn-primary" id="aiAsk">–°–ø—Ä–æ—Å–∏—Ç—å –ò–ò</button>
              <button class="btn-ghost" id="aiClear">–û—á–∏—Å—Ç–∏—Ç—å</button>
              <div class="small" style="margin-left:auto;color:var(--muted)">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ä—É—Å—Å–∫–∏–π/–∞–Ω–≥–ª–∏–π—Å–∫–∏–π</div>
            </div>
            <div class="ai-response" id="aiResponse" aria-live="polite"></div>
          </div>
        </div>

        <footer><small id="footerCredits">IBprofen demo ‚Äî –≥–æ—Ç–æ–≤–æ –∫ —Ö–∞–∫–∞—Ç–æ–Ω—É</small></footer>
      </div>

      <!-- RIGHT (sidebar) -->
      <aside class="sidebar">
        <div class="panel">
          <h2 class="section-title">–ö–æ–º–∞–Ω–¥–∞ (–∫—É–¥–∞ –≤—Å—Ç–∞–≤–ª—è—Ç—å —Ñ–æ—Ç–æ)</h2>
          <div id="team" style="display:flex;flex-direction:column;gap:10px">
            <!-- Example card with image placeholder -->
            <!-- To add real photos: replace src with "images/jony.jpg" and put image in folder -->
            <div style="display:flex;gap:10px;align-items:center">
              <div style="width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700;color:#04282a">DJ</div>
              <div>
                <div style="font-weight:700">–î–æ–≤—Ä–æ–Ω–æ–≤ –ñ–æ–Ω–∏–±–µ–∫</div>
                <div class="small">–ö–∞–ø–∏—Ç–∞–Ω –∫–æ–º–∞–Ω–¥—ã</div>
              </div>
            </div>

            <div style="display:flex;gap:10px;align-items:center">
              <div style="width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700;color:#04282a">MA</div>
              <div>
                <div style="font-weight:700">–ú”ô—Ä—ñ–ø–±–µ–∫ ”ò–¥–ª–µ—Ç</div>
                <div class="small">–¢–µ—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç</div>
              </div>
            </div>

            <div style="display:flex;gap:10px;align-items:center">
              <div style="width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700;color:#04282a">NI</div>
              <div>
                <div style="font-weight:700">–ù–∞–Ω–∏–µ–≤ –ò–º—Ä–∞–Ω</div>
                <div class="small">–î–∏–∑–∞–π–Ω–µ—Ä</div>
              </div>
            </div>
          </div>
        </div>

        <div class="panel" style="margin-top:12px">
          <h2 class="section-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–¥–µ–º–æ)</h2>
          <div class="small">–ü–∞—Ü–∏–µ–Ω—Ç–æ–≤: <strong id="statsPatients">0</strong></div>
          <div class="small">–í—Ä–∞—á–µ–π: <strong id="statsDoctors">0</strong></div>
          <div class="small">–ó–∞–ø–∏—Å–µ–π: <strong id="statsAppointments">0</strong></div>
        </div>
      </aside>
    </div>
  </div>
</div>

<script>
/* ================== Data & initial setup ================== */
/* Test accounts (you can change them) */
const USERS = [
  {id:1, role:'admin', login:'admin', password:'Jony707', name:'–î–æ–≤—Ä–æ–Ω–æ–≤ –ñ–æ–Ω–∏–±–µ–∫'},
  {id:2, role:'doctor', login:'imran', password:'Imran990', name:'–ù–∞–Ω–∏–µ–≤ –ò–º—Ä–∞–Ω'},
  {id:3, role:'doctor', login:'adlet', password:'Adlet990', name:'–ú”ô—Ä—ñ–ø–±–µ–∫ ”ò–¥–ª–µ—Ç'},
  {id:4, role:'patient', login:'filko', password:'Alaton1', name:'–§–∏–ª–∫–æ –ò–≤–∞–Ω'},
  {id:5, role:'patient', login:'myrz', password:'Alaton1', name:'Myrzakunurov –ê—Ä–º–∞–Ω'},
  {id:6, role:'patient', login:'dinara', password:'Alaton1', name:'Kozhamzharova –î–∏–Ω–∞—Ä–∞'},
];

/* In-memory app state (demo) */
let state = {
  currentUser: null,
  appointments: [], // {patient, doctor, date, status}
  balances: {},     // patientName -> balance number
};

/* Add initial balances */
USERS.filter(u=>u.role==='patient').forEach(p=>state.balances[p.name] = Math.floor(Math.random()*100));

/* Quick login widgets */
const quick = document.getElementById('quick');
USERS.forEach(u=>{
  const chip = document.createElement('div');
  chip.className = 'chip';
  chip.textContent = `${u.name} (${u.role})`;
  chip.onclick = ()=>{ document.getElementById('login').value = u.login; document.getElementById('password').value = u.password; };
  quick.appendChild(chip);
});

/* Stats update */
function updateStats(){
  document.getElementById('statsPatients').innerText = USERS.filter(u=>u.role==='patient').length;
  document.getElementById('statsDoctors').innerText = USERS.filter(u=>u.role==='doctor').length;
  document.getElementById('statsAppointments').innerText = state.appointments.length;
}

/* ================== AUTH & INIT ================== */
document.getElementById('doLogin').addEventListener('click', doLoginFromBtn);
document.getElementById('login').addEventListener('keydown', e => { if(e.key==='Enter') doLoginFromBtn(); });
document.getElementById('password').addEventListener('keydown', e => { if(e.key==='Enter') doLoginFromBtn(); });

function doLoginFromBtn(){
  const L = document.getElementById('login').value.trim();
  const P = document.getElementById('password').value;
  const u = USERS.find(x => x.login === L && x.password === P);
  const err = document.getElementById('login-error');
  if(!u){ err.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å'; return; }
  err.textContent = '';
  state.currentUser = u;
  showAppForUser(u);
}

/* Demo register (no real signup, just alert) */
document.getElementById('demoRegister').addEventListener('click', ()=> alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –¥–µ–º–æ –æ—Ç–∫–ª—é—á–µ–Ω–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥.'));

function showAppForUser(user){
  // hide login, show main
  document.getElementById('login-panel').style.display = 'none';
  document.getElementById('main').style.display = 'block';
  // fill header user info
  document.getElementById('who').innerText = user.name;
  document.getElementById('role').innerText = user.role.toUpperCase();
  // init modules
  populatePatientDoctorSelects();
  renderBalances();
  updateStats();
  // generate some demo appointments (if empty)
  if(state.appointments.length === 0) generateDemoAppointments(8);
  renderAppointmentsTable();
  // set welcome texts
  transSet('welcomeTitle', {ru:'–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ IBprofen', en:'Welcome to IBprofen', kz:'IBprofen-–≥–µ “õ–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑', zh:'Ê¨¢ËøéÊù•Âà∞ IBprofen'});
  transSet('welcomeDesc', {ru:'–ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–∞—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞: –∑–∞–ø–∏—Å—å –∫ –≤—Ä–∞—á—É, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞–º–∏ –∏ —É–º–Ω—ã–π –ò–ò‚Äë–ø–æ–º–æ—â–Ω–∏–∫.', en:'Innovative medical system: appointments, bonuses and AI assistant.', kz:'–ò–Ω–Ω–æ–≤–∞—Ü–∏—è–ª—ã“õ –º–µ–¥–∏—Ü–∏–Ω–∞–ª—ã“õ –∂“Ø–π–µ: –¥”ô—Ä—ñ–≥–µ—Ä–≥–µ –∂–∞–∑—ã–ª—É, –±–æ–Ω—É—Å—Ç–∞—Ä –∂”ô–Ω–µ –ò–ò‚Äë–∫”©–º–µ–∫—à—ñ.', zh:'ÂàõÊñ∞ÂåªÁñóÁ≥ªÁªüÔºöÈ¢ÑÁ∫¶„ÄÅÂ•ñÂä±‰∏é AI Âä©Êâã„ÄÇ'});
}

/* ================== Appointments ================== */
function populatePatientDoctorSelects(){
  const ps = document.getElementById('selectPatient');
  const ds = document.getElementById('selectDoctor');
  ps.innerHTML=''; ds.innerHTML='';
  USERS.filter(u=>u.role==='patient').forEach(p=>{
    const o = document.createElement('option'); o.value=p.name; o.textContent = p.name; ps.appendChild(o);
  });
  USERS.filter(u=>u.role==='doctor').forEach(d=>{
    const o = document.createElement('option'); o.value=d.name; o.textContent = d.name; ds.appendChild(o);
  });
}

document.getElementById('bookBtn').addEventListener('click', ()=>{
  const patient = document.getElementById('selectPatient').value;
  const doctor  = document.getElementById('selectDoctor').value;
  const date    = document.getElementById('selectDate').value;
  if(!date) { alert('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É'); return; }
  // simple conflict check:
  const conflict = state.appointments.some(a => a.doctor===doctor && a.date === date);
  if(conflict){ alert('–£ –≤—Ä–∞—á–∞ —É–∂–µ –µ—Å—Ç—å –∑–∞–ø–∏—Å—å –Ω–∞ —ç—Ç—É –¥–∞—Ç—É'); return; }
  const ap = {patient, doctor, date, status:'–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ'};
  state.appointments.push(ap);
  renderAppointmentsTable();
  updateStats();
  alert(`–ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–Ω–∞: ${patient} ‚Üí ${doctor} (${date})`);
});

document.getElementById('showSchedule').addEventListener('click', ()=> renderAppointmentsTable());

function renderAppointmentsTable(){
  const tbody = document.querySelector('#appointmentsTable tbody');
  tbody.innerHTML = '';
  state.appointments.slice().reverse().forEach(a=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${a.patient}</td><td>${a.doctor}</td><td>${a.date}</td><td>${a.status}</td>`;
    tbody.appendChild(tr);
  });
}

/* Demo generate appointments */
function generateDemoAppointments(n=10){
  const patients = USERS.filter(u=>u.role==='patient').map(p=>p.name);
  const doctors = USERS.filter(u=>u.role==='doctor').map(d=>d.name);
  const today = new Date();
  for(let i=0;i<n;i++){
    const date = new Date(today.getTime() + (i+1)*24*3600*1000);
    const dstr = date.toISOString().slice(0,10);
    state.appointments.push({
      patient: patients[i % patients.length],
      doctor: doctors[i % doctors.length],
      date: dstr,
      status: (i%3===0)?'–ó–∞–≤–µ—Ä—à–µ–Ω–æ':'–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ'
    });
  }
}

/* ================== Bonuses & balances ================== */
function renderBalances(){
  const tbody = document.querySelector('#bonusTable tbody');
  tbody.innerHTML = '';
  Object.keys(state.balances).forEach(name=>{
    const bonuses = Math.floor(state.balances[name] / 2);
    const penalties = Math.floor(Math.random()*5);
    const balance = state.balances[name];
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${name}</td><td>${bonuses}</td><td>${penalties}</td><td>${balance}</td>`;
    tbody.appendChild(tr);
  });

  // controls: add/subtract bonuses for current user (if admin see all)
  const ctr = document.getElementById('bonusControls');
  ctr.innerHTML = '';
  const cur = state.currentUser;
  if(!cur) return;
  if(cur.role === 'admin'){
    // admin can adjust any patient
    USERS.filter(u=>u.role==='patient').forEach(p=>{
      const b = document.createElement('button');
      b.className = 'btn-ghost';
      b.textContent = `+10 ${p.name}`;
      b.onclick = ()=>{ state.balances[p.name] +=10; renderBalances(); };
      const m = document.createElement('button'); m.className='btn-ghost'; m.textContent=`-10 ${p.name}`;
      m.onclick = ()=>{ state.balances[p.name] = Math.max(0, state.balances[p.name]-10); renderBalances(); };
      ctr.appendChild(b); ctr.appendChild(m);
    });
  } else if(cur.role === 'patient'){
    const add = document.createElement('button'); add.className='btn-primary'; add.textContent='–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å +10';
    add.onclick = ()=>{ state.balances[cur.name] +=10; renderBalances(); alert('–ë–æ–Ω—É—Å +10 –Ω–∞—á–∏—Å–ª–µ–Ω (–¥–µ–º–æ)'); };
    const spend = document.createElement('button'); spend.className='btn-ghost'; spend.textContent='–°–ø–∏—Å–∞—Ç—å -5';
    spend.onclick = ()=>{ state.balances[cur.name] = Math.max(0, state.balances[cur.name]-5); renderBalances(); alert('–°–ø–∏—Å–∞–Ω–æ -5 (–¥–µ–º–æ)'); };
    ctr.appendChild(add); ctr.appendChild(spend);
  } else {
    ctr.innerHTML = '<div class="small">–î–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –∏ –∞–¥–º–∏–Ω–∞</div>';
  }
}

/* ================== AI assistant ================== */
/* Improved keyword-based mapping to specialties */
const AI_RULES = [
  {keys:['–∂–∏–≤–æ—Ç','–±–æ–ª—å –≤ –∂–∏–≤–æ—Ç–µ','—Ç–æ—à–Ω–æ','—Ç–æ—à–Ω–æ—Ç–∞','—Ä–≤–æ—Ç–∞','–¥–∏–∞—Ä–µ—è','–ø–µ—á–µ–Ω—å','–≥–∞—Å—Ç—Ä–∏—Ç','–≥–∞—Å—Ç—Ä–æ—ç–Ω—Ç–µ—Ä–∏—Ç'], doctor:'–ì–∞—Å—Ç—Ä–æ—ç–Ω—Ç–µ—Ä–æ–ª–æ–≥', advice:'–ï—Å–ª–∏ –±–æ–ª—å —Å–∏–ª—å–Ω–∞—è –∏–ª–∏ –¥–ª–∏—Ç—Å—è –±–æ–ª–µ–µ —Å—É—Ç–æ–∫ ‚Äî —Å—Ä–æ—á–Ω–æ –∫ –≥–∞—Å—Ç—Ä–æ—ç–Ω—Ç–µ—Ä–æ–ª–æ–≥—É. –ü–µ–π—Ç–µ –≤–æ–¥—É, –∏–∑–±–µ–≥–∞–π—Ç–µ –∂–∏—Ä–Ω–æ–π –ø–∏—â–∏.'},
  {keys:['–≥–ª–∞–∑–∞','–∑—Ä–µ–Ω–∏–µ','—Å–≤–µ—Ç–æ–±–æ—è–∑–Ω—å','—Å–ª–µ–ø–æ—Ç–∞','–∑—É–¥ –≥–ª–∞–∑','—Ä–µ–∑—å –≤ –≥–ª–∞–∑–∞—Ö'], doctor:'–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥', advice:'–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –æ—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑—Ä–µ–Ω–∏—è –∏ –æ—Å–º–æ—Ç—Ä–∞.'},
  {keys:['–≥–æ–ª–æ–≤–∞','–≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å','–º–∏–≥—Ä–µ–Ω—å','–≥–æ–ª–æ–≤–æ–∫—Ä—É–∂–µ–Ω–∏–µ'], doctor:'–ù–µ–≤—Ä–æ–ª–æ–≥', advice:'–ï—Å–ª–∏ —á–∞—Å—Ç–æ –±–æ–ª–∏—Ç –≥–æ–ª–æ–≤–∞ –∏–ª–∏ –µ—Å—Ç—å –Ω–µ–æ–±—ã—á–Ω—ã–µ —Å–∏–º–ø—Ç–æ–º—ã ‚Äî –ø–æ–∫–∞–∂–∏—Ç–µ—Å—å –Ω–µ–≤—Ä–æ–ª–æ–≥—É.'},
  {keys:['—Å–µ—Ä–¥—Ü–µ','–±–æ–ª—å –≤ –≥—Ä—É–¥–∏','—Ç–∞—Ö–∏–∫–∞—Ä–¥–∏—è','—Å–µ—Ä–¥—Ü–µ–±–∏–µ–Ω–∏–µ'], doctor:'–ö–∞—Ä–¥–∏–æ–ª–æ–≥', advice:'–ü—Ä–∏ –±–æ–ª–∏ –≤ –≥—Ä—É–¥–∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∫–∞—Ä–¥–∏–æ–ª–æ–≥—É / –≤ –Ω–µ–æ—Ç–ª–æ–∂–∫—É.'},
  {keys:['–∫–∞—à–µ–ª—å','–∫–∞—à–ª—è–µ—Ç','–∫–∞—à–µ–ª—å –∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞','–≥–æ—Ä–ª–æ','–±–æ–ª—å –≤ –≥–æ—Ä–ª–µ'], doctor:'–¢–µ—Ä–∞–ø–µ–≤—Ç / –õ–û–†', advice:'–ï—Å–ª–∏ –∫–∞—à–µ–ª—å –¥–ª–∏—Ç–µ–ª—å–Ω—ã–π –∏–ª–∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ—Ç—Å—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π ‚Äî –∫ —Ç–µ—Ä–∞–ø–µ–≤—Ç—É –∏–ª–∏ –õ–û–†—É.'},
  {keys:['–∞–ª–ª–µ—Ä–≥','—Å—ã–ø—å','–∑—É–¥','–∫—Ä–∞–ø–∏–≤–Ω–∏—Ü–∞','–æ—Ç–µ–∫'], doctor:'–ê–ª–ª–µ—Ä–≥–æ–ª–æ–≥', advice:'–í–æ–∑–º–æ–∂–Ω–æ –∞–ª–ª–µ—Ä–≥–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–∫—Ü–∏—è ‚Äî –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–ª–ª–µ—Ä–≥–æ–ª–æ–≥—É.'},
  {keys:['—Å—É—Å—Ç–∞–≤','–±–æ–ª—å –≤ —Å—É—Å—Ç–∞–≤','–∞—Ä—Ç—Ä–∏—Ç','–±–æ–ª–∏ –≤ —Å–ø–∏–Ω–µ'], doctor:'–†–µ–≤–º–∞—Ç–æ–ª–æ–≥ / –û—Ä—Ç–æ–ø–µ–¥', advice:'–ü–æ–∫–∞–∑–∞—Ç—å—Å—è –∫ –æ—Ä—Ç–æ–ø–µ–¥—É –∏–ª–∏ —Ä–µ–≤–º–∞—Ç–æ–ª–æ–≥—É –¥–ª—è –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.'},
  {keys:['–ø—Å–∏—Ö','–¥–µ–ø—Ä–µ—Å—Å','—Ç—Ä–µ–≤–æ–≥–∞','—Å—Ç—Ä–µ—Å—Å','—Å–æ–Ω'], doctor:'–ü—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç', advice:'–ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –∂–∏–∑–Ω—å ‚Äî –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç—É.'},
  {keys:['–¥–∏–∞–±–µ—Ç','—Å–∞—Ö–∞—Ä','–≥–ª—é–∫–æ–∑–∞'], doctor:'–≠–Ω–¥–æ–∫—Ä–∏–Ω–æ–ª–æ–≥', advice:'–ù—É–∂–Ω–æ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —É —ç–Ω–¥–æ–∫—Ä–∏–Ω–æ–ª–æ–≥–∞ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–∞—Ö–∞—Ä–∞.'},
];

function aiSuggest(text){
  if(!text || text.trim().length < 2) return {doctor:null, advice:'–û–ø–∏—à–∏—Ç–µ —Å–∏–º–ø—Ç–æ–º—ã —á—É—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ.'};
  const s = text.toLowerCase();
  // try to match by keys (longer words first)
  for(const rule of AI_RULES){
    for(const k of rule.keys){
      if(s.includes(k)){
        return {doctor: rule.doctor, advice: rule.advice};
      }
    }
  }
  // fallback: simple heuristics
  if(s.includes('—Ç–µ–º–ø–µ—Ä–∞') || s.includes('–ª–∏—Ö–æ—Ä–∞–¥') || s.includes('–∂–∞—Ä')){
    return {doctor:'–¢–µ—Ä–∞–ø–µ–≤—Ç', advice:'–ü–æ–≤—ã—à–µ–Ω–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ ‚Äî –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ç–µ—Ä–∞–ø–µ–≤—Ç—É.'};
  }
  return {doctor:'–¢–µ—Ä–∞–ø–µ–≤—Ç', advice:'–°–∏–º–ø—Ç–æ–º—ã –Ω–µ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã ‚Äî –Ω–∞—á–Ω–∏—Ç–µ —Å —Ç–µ—Ä–∞–ø–µ–≤—Ç–∞ –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –æ—Å–º–æ—Ç—Ä–∞.'};
}

document.getElementById('aiAsk').addEventListener('click', ()=>{
  const text = document.getElementById('aiInput').value;
  const resp = aiSuggest(text);
  const out = document.getElementById('aiResponse');
  out.innerHTML = `<strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> ${resp.advice} <div class="small" style="margin-top:6px">–ü–æ–¥—Ö–æ–¥–∏—Ç —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç: <strong>${resp.doctor}</strong></div>`;
  // offer quick action: show doctors of that specialty
  const docNames = USERS.filter(u=>u.role==='doctor').map(d=>d.name).join(', ');
  // If needed, could map specialty->doctor; for demo we show all docs with button to record appointment
  const quick = document.createElement('div'); quick.style.marginTop='8px';
  const bookBtn = document.createElement('button'); bookBtn.className='btn-primary'; bookBtn.textContent='–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É (–±—ã—Å—Ç—Ä–æ)';
  bookBtn.onclick = ()=> {
    // set selects to first patient/current user if patient
    if(state.currentUser && state.currentUser.role==='patient'){
      document.getElementById('selectPatient').value = state.currentUser.name;
    }
    // set doctor to first available (demo)
    const doc = USERS.find(u=>u.role==='doctor');
    if(doc) document.getElementById('selectDoctor').value = doc.name;
    // set date to tomorrow
    const tomorrow = new Date(Date.now()+24*3600*1000);
    document.getElementById('selectDate').value = tomorrow.toISOString().slice(0,10);
    alert('–ü–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã ‚Äî –Ω–∞–∂–º–∏—Ç–µ "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è" —á—Ç–æ–±—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å.');
  };
  quick.appendChild(bookBtn);
  out.appendChild(quick);
});

/* Clear AI */
document.getElementById('aiClear').addEventListener('click', ()=>{
  document.getElementById('aiInput').value = '';
  document.getElementById('aiResponse').innerHTML = '';
});

/* ================== THEMING & LANGUAGE (basic) ================== */
document.getElementById('themeToggle').addEventListener('click', ()=>{
  document.body.classList.toggle('light');
});

/* Minimal language switch: changes UI labels (expandable) */
const DICT = {
  ru: {
    loginTitle:'–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É',
    book:'–ó–∞–ø–∏—Å–∞—Ç—å—Å—è',
    appointments:'–ó–∞–ø–∏—Å–∏',
    bonus:'–ë–æ–Ω—É—Å—ã –∏ —à—Ç—Ä–∞—Ñ—ã',
    ai:'–ò–ò‚Äë–ø–æ–º–æ—â–Ω–∏–∫',
    patient:'–ü–∞—Ü–∏–µ–Ω—Ç',
    doctor:'–í—Ä–∞—á',
    date:'–î–∞—Ç–∞',
    welcome:'–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ IBprofen'
  },
  en: {
    loginTitle:'Sign in',
    book:'Book appointment',
    appointments:'Appointments',
    bonus:'Bonuses & Penalties',
    ai:'AI Assistant',
    patient:'Patient',
    doctor:'Doctor',
    date:'Date',
    welcome:'Welcome to IBprofen'
  },
  kz: {
    loginTitle:'–ñ“Ø–π–µ–≥–µ –∫—ñ—Ä—É',
    book:'–ë–µ–ª–≥—ñ–ª–µ—É',
    appointments:'–¢—ñ—Ä–∫–µ–ª—ñ–º–¥–µ—Ä',
    bonus:'–ë–æ–Ω—É—Å –ø–µ–Ω –∞–π—ã–ø—Ç–∞—Ä',
    ai:'–ò–ò‚Äë–∫”©–º–µ–∫—à—ñ',
    patient:'–ü–∞—Ü–∏–µ–Ω—Ç',
    doctor:'–î”ô—Ä—ñ–≥–µ—Ä',
    date:'–ö“Ø–Ω',
    welcome:'IBprofen-–≥–µ “õ–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑'
  },
  zh: {
    loginTitle:'ÁôªÂΩïÁ≥ªÁªü',
    book:'È¢ÑÁ∫¶',
    appointments:'È¢ÑÁ∫¶ËÆ∞ÂΩï',
    bonus:'Â•ñÂä±‰∏éÁΩöÊ¨æ',
    ai:'AI Âä©Êâã',
    patient:'ÊÇ£ËÄÖ',
    doctor:'ÂåªÁîü',
    date:'Êó•Êúü',
    welcome:'Ê¨¢ËøéÊù•Âà∞ IBprofen'
  }
};

document.getElementById('lang').addEventListener('change', ()=>{
  const L = document.getElementById('lang').value;
  const d = DICT[L] || DICT['ru'];
  // update a few labels
  document.getElementById('bookBtn').textContent = d.book;
  document.getElementById('appointmentsTitle').textContent = d.appointments;
  document.getElementById('bonusTitle').textContent = d.bonus;
  document.getElementById('aiTitle').textContent = d.ai;
  document.getElementById('selectPatientLabel').textContent = d.patient;
  document.getElementById('selectDoctorLabel').textContent = d.doctor;
  document.getElementById('selectDateLabel').textContent = d.date;
  // welcome
  document.getElementById('welcomeTitle').textContent = d.welcome;
});

/* Help button */
document.getElementById('helpBtn').addEventListener('click', ()=>{
  alert('IBprofen demo\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∑–∞–ø–∏—Å—å –∏ –ò–ò. –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω—É–∂–Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å –∏ –∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö.');
});

/* init UI */
updateStats();

/* Optional: preload demo content (generate many items for "big" feeling) */
(function generateBulkDemo(){
  // generate many demo appointments to make UI feel large (adjust count)
  for(let i=0;i<60;i++){
    generateDemoAppointments(1);
  }
  updateStats();
  renderAppointmentsTable();
  renderBalances();
})();
</script>
</body>
  </html>
